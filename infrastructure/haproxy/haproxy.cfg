global
    maxconn 4096
    log stdout local0
    log stdout local1 notice

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option httplog
    log global

frontend http_front
    bind *:80
    stats uri /haproxy?stats
    
    # ACL for different services
    acl is_api path_beg /api
    acl is_ws path_beg /ws
    
    # Route to appropriate backend
    use_backend api_backend if is_api
    use_backend ws_backend if is_ws
    default_backend frontend_backend

backend api_backend
    balance roundrobin
    server api1 api-gateway:3000 check

backend ws_backend
    balance source
    server presence1 presence-service:3005 check

backend frontend_backend
    server frontend1 frontend:3006 check

listen stats
    bind *:8080
    stats enable
    stats uri /
    stats refresh 30s
